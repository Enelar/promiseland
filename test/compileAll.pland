var fs = require "fs";

var callback = new Callback();

fs.readdir(".", callback.callback);

files = (*callback.promise)[1];


if (files){
  for (var i = 0; i < files.length; ++i){
    callback = new Callback();
    var filename = files[i];
    
    
    if (filename.substr( filename.length - 6 ) == ".pland"){
      console.log("processing:" + filename);
      fs.readFile(filename, {
            encoding: "utf8"
          }, callback.callback);
      var codeStr = (*callback.promise)[1];
      parser = new promiseland.Parser();
      
      var jsStr = (*parser.parse(codeStr)).javascript;
      
      callback = new Callback();
      fs.writeFile(filename.substr(0, filename.length - 6 ) + ".js", jsStr, callback.callback);
      *callback.promise;
      console.log("done");
    };
  };
};