<script src="requirejs/require.js"></script>
<script>
  require.config({
    baseUrl: "../",
    paths: {
        "promiseland": "promiseland"
        , "test": "test"
    },
    waitSeconds: 15
  });
  
  var testObj = {
    
  };
  
  testObj.basicmodule = false;
  try{
    require( ["promiseland", "test/basicmodule"],
      function(promiseland, basicmodule) {
        basicmodule.then(function(mod){
          if (typeof mod == "object"){
            testObj.basicmodule = true;
          };
        });
      }
    );
  }catch(e){
  };
  
  testObj.creatingpromise = false;
  try{
    require( ["promiseland", "test/creatingpromise"],
      function(promiseland, creatingpromise) {
        creatingpromise.then(function(mod){
          mod.fun().then(function(res){
            if (res == 4){
              testObj.creatingpromise = true;
            };
          });
        });
      }
    );
  }catch(e){
  };
  
  testObj.creatingpromise2 = false;
  try{
    require( ["promiseland", "test/creatingpromise2"],
      function(promiseland, creatingpromise2) {
        creatingpromise2.then(function(mod){
          mod.fun().then(function(res){
            if (res == 4){
              testObj.creatingpromise2 = true;
            };
          });
        });
      }
    );
  }catch(e){
  };
  
  var createTest = function(parModuleName, parFun){
    testObj[parModuleName] = false;
    var successFun = function(){
      testObj[parModuleName] = true;
    };
    try{
      require( ["test/" + parModuleName],
        function(modPs) {
          modPs.then(function(mod){
            parFun(mod, successFun);
          });
        }
      );
    }catch(e){
    };
  };
  
  var funReturning4 = function(mod, success){
    mod.fun().then(function(value){
      if (value == 4){
        success();
      };
    });
  };
  
  createTest("conditional", funReturning4);
  createTest("conditional2", funReturning4);
  createTest("conditional3", funReturning4);
  
  createTest("callback", funReturning4);
  createTest("callback2", funReturning4);
  
  createTest("forloop", funReturning4);
  
  setTimeout(function(){
    var c = 0;
    var s = 0;
    var f = 0;
    for (var m in testObj){
      c++;
      if (testObj[m]){
        s++;
      }else{
        console.log(m + " failed!");
        f++;
      };
    };
    console.log("run " + c + " tests. " + s + " successful, " + f + " failed");
  }, 2000);
</script>